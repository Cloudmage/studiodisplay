(function(){function y(a){return new Date(864E5*(a+.5-2440588))}function E(a,b){return m(d(a)*e(z)-B(b)*d(z),e(a))}function C(a,b){return F(d(b)*e(z)+e(b)*d(z)*d(a))}function G(a,b,c){return x+m(d(a),e(a)*d(b)-B(c)*e(b))}function H(a,b,c){return F(d(b)*d(c)+e(b)*e(c)*e(a))}function I(a){var b=f*(1.9148*d(a)+.02*d(2*a)+3E-4*d(3*a));return a+b+102.9372*f+x}function J(a){a=I(f*(357.5291+.98560028*a));return{dec:C(a,0),ra:E(a,0)}}function K(a){var b=f*(134.963+13.064993*a),c=f*(93.272+13.22935*a);a=f*
(218.316+13.176396*a)+6.289*f*d(b);c=5.128*f*d(c);b=385001-20905*e(b);return{ra:E(a,c),dec:C(a,c),dist:b}}function A(a,b){return new Date(a.valueOf()+864E5*b/24)}var x=Math.PI,d=Math.sin,e=Math.cos,B=Math.tan,F=Math.asin,m=Math.atan2,L=Math.acos,f=x/180,z=23.4397*f,k={getPosition:function(a,b,c){c=f*-c;b*=f;var d=a.valueOf()/864E5-.5+2440588-2451545;a=J(d);c=f*(280.16+360.9856235*d)-c-a.ra;return{azimuth:G(c,b,a.dec),altitude:H(c,b,a.dec)}}},D=k.times=[[6,"goldenHourEnd","goldenHour"],[-.3,"sunriseEnd",
"sunsetStart"],[-.833,"sunrise","sunset"],[-4,"blueHourDawnEnd","blueHourDusk"],[-6,"dawn","dusk"],[-8,"blueHourDawn","blueHourDuskEnd"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"]];k.addTime=function(a,b,c){D.push([a,b,c])};k.getTimes=function(a,b,c){c=f*-c;b*=f;a=Math.round(a.valueOf()/864E5-.5+2440588-2451545-9E-4-c/(2*x));var g=9E-4+(0+c)/(2*x)+a,k=f*(357.5291+.98560028*g),u=I(k),M=C(u,0),g=2451545+g+.0053*d(k)-.0069*d(2*u),n,w,q,l,p,v={solarNoon:y(g),nadir:y(g-.5)};n=0;for(w=
D.length;n<w;n+=1){q=D[n];l=c;p=a;var r=k,t=u,h;h=b;var m=M;h=(d(q[0]*f)-d(h)*d(m))/(e(h)*e(m));h=1<h?-Infinity:-1>h?Infinity:L(h);l=isFinite(h)?2451545+(9E-4+(h+l)/(2*x)+p)+.0053*d(r)-.0069*d(2*t):h;isFinite(l)||(g=0);p=g-(l-g);v[q[1]]=isFinite(p)?y(p):null;v[q[2]]=isFinite(l)?y(l):null}return v};k.getMoonPosition=function(a,b,c){c=f*-c;b*=f;var g=a.valueOf()/864E5-.5+2440588-2451545;a=K(g);c=f*(280.16+360.9856235*g)-c-a.ra;var g=H(c,b,a.dec),k=m(d(c),B(b)*e(a.dec)-d(a.dec)*e(c)),u=g;0>u&&(u=0);
g+=2.967E-4/Math.tan(u+.00312536/(u+.08901179));return{azimuth:G(c,b,a.dec),altitude:g,distance:a.dist,parallacticAngle:k}};k.getMoonIllumination=function(a){var b=(a||new Date).valueOf()/864E5-.5+2440588-2451545;a=J(b);var b=K(b),c=L(d(a.dec)*d(b.dec)+e(a.dec)*e(b.dec)*e(a.ra-b.ra)),c=m(149598E3*d(c),b.dist-149598E3*e(c));a=m(e(a.dec)*d(a.ra-b.ra),d(a.dec)*e(b.dec)-e(a.dec)*d(b.dec)*e(a.ra-b.ra));fraction=(1+e(c))/2;phase=.5+.5*c*(0>a?-1:1)/Math.PI;age=parseInt(Math.floor(100*phase/(100/28)),10);
return{fraction:fraction,phase:phase,angle:a,age:age}};k.getMoonTimes=function(a,b,c,d){a=new Date(a);d?a.setUTCHours(0,0,0,0):a.setHours(0,0,0,0);for(var e=.133*f,g=k.getMoonPosition(a,b,c).altitude-e,m=d=0,n,w,q,l,p,v,r,t,h=1;24>=h;h+=2){n=k.getMoonPosition(A(a,h),b,c).altitude-e;w=k.getMoonPosition(A(a,h+1),b,c).altitude-e;q=(g+w)/2-n;l=(w-g)/2;p=-l/(2*q);v=(q*p+l)*p+n;l=l*l-4*q*n;n=0;0<=l&&(t=Math.sqrt(l)/(2*Math.abs(q)),r=p-t,t=p+t,1>=Math.abs(r)&&n++,1>=Math.abs(t)&&n++,-1>r&&(r=t));1===n?0>
g?d=h+r:m=h+r:2===n&&(d=h+(0>v?t:r),m=h+(0>v?r:t));if(d&&m)break;g=w}b={};d&&(b.rise=A(a,d));m&&(b.set=A(a,m));d||m||(b[0<v?"alwaysUp":"alwaysDown"]=!0);return b};"object"===typeof exports&&"undefined"!==typeof module?module.exports=k:"function"===typeof define&&define.amd?define(k):window.SunCalc=k})();
